import '@testing-library/jest-dom';
import { render, screen, fireEvent } from '@testing-library/react';
import React from 'react';
import { sessionUtility } from '../../../shared/utilities/session';
import { withRouter, Router } from 'react-router-dom';
import { createMemoryHistory } from 'history';
import { ModalContext } from '../../../../NSATRG/templates/TroubleShooting/ModalContext';
import { ConfigContext } from "../../../../../IssueSelector";
import { ParamsContext } from  "../../../../../IssueSelector";
// Import the actual component
import TroubleShootingNewPage from '../TroubleShootingNewPage';

// Create a wrapped version of the component
const WrappedComponent = withRouter(TroubleShootingNewPage);

// Helper function to render with all required contexts
const renderWithContexts = (ui, { route = '/' } = {}) => {
  const history = createMemoryHistory({ initialEntries: [route] });
  
  const modalContextValue = {
    additionalInfoSteps: [],
    setAdditionalInfoSteps: jest.fn(),
    showModal: false,
    setShowModal: jest.fn(),
    modalContent: null,
    setModalContent: jest.fn(),
    modalParams: {
      title: '',
      body: '',
      buttons: []
    },
    setModalParams: jest.fn()
  };

  const configContextValue = {
    paramsDetails: { 
      channel: 'CARE',
      isDigital: false,
      isRetail: false
    }
  };

  const paramsContextValue = {
    paramsDetails: {}
  };

  return render(
    <Router history={history}>
      <ModalContext.Provider value={modalContextValue}>
        <ConfigContext.Provider value={configContextValue}>
          <ParamsContext.Provider value={paramsContextValue}>
              {ui}
          </ParamsContext.Provider>
        </ConfigContext.Provider>
      </ModalContext.Provider>
    </Router>
  );
};

describe('TroubleShootingNewPage', () => {
  // Helper function to create props with default values
  const createTestProps = (options = {}) => {
    const defaultFunctions = {
      handleTroubleShootingAction: jest.fn(),
      handleAction: jest.fn(),
      processTroubleShootingPage: jest.fn()
    };

    const defaultValues = {
      troubleShootingInfo: sessionUtility.getTroubleShootingJson() || {
        ddata: {
          output: {
            pageContent: {
              steps: []
            },
            navHist: []
          }
        }
      },
      landingInfo: {},
      symptom: {},
      selectedIssueOptionStep: '',
      thumbsDownSubmittedStep: false
    };

    return {
      functions: {
        ...defaultFunctions,
        ...(options.functions || {})
      },
      values: {
        ...defaultValues,
        ...(options.values || {})
      }
    };
  };

  it('renders without crashing', () => {
    const props = createTestProps();
    renderWithContexts(<WrappedComponent {...props} />);
  });

  it('renders with custom props', () => {
    const customProps = createTestProps({
      values: {
        troubleShootingInfo: {
          ddata: {
            output: {
              pageContent: {
                steps: [{
                  id: 'test-step',
                  title: 'Test Step'
                }]
              },
              navHist: []
            }
          }
        }
      }
    });
    renderWithContexts(<WrappedComponent {...customProps} />);
  });
});
