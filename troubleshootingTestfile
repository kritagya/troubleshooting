import '@testing-library/jest-dom';
import { render, screen, fireEvent } from '@testing-library/react';
import React from 'react';
import { sessionUtility } from '../../../shared/utilities/session';
import { withRouter, Router } from 'react-router-dom';
import { createMemoryHistory } from 'history';
import { ModalContext } from '../../../shared/contexts/ModalContext';
import { ConfigContext } from '../../../shared/contexts/ConfigContext';
import { ParamsContext } from '../../../shared/contexts/ParamsContext';
import { UiLoggerContext } from '../../../shared/contexts/UiLoggerContext';

// Import the actual component
import TroubleShootingNewPage from '../TroubleShootingNewPage';

// Create a wrapped version of the component
const WrappedComponent = withRouter(TroubleShootingNewPage);

// Helper function to render with all required contexts
const renderWithContexts = (ui, { route = '/' } = {}) => {
  const history = createMemoryHistory({ initialEntries: [route] });
  
  const modalContextValue = {
    additionalInfoSteps: [],
    setAdditionalInfoSteps: jest.fn(),
    showModal: false,
    setShowModal: jest.fn(),
    modalContent: null,
    setModalContent: jest.fn(),
    modalParams: {
      title: '',
      body: '',
      buttons: []
    },
    setModalParams: jest.fn()
  };

  const configContextValue = {
    paramsDetails: { 
      channel: 'CARE',
      isDigital: false,
      isRetail: false
    }
  };

  const paramsContextValue = {
    paramsDetails: {}
  };

  const uiLoggerContextValue = {
    logUIEvent: jest.fn()
  };

  return render(
    <Router history={history}>
      <ModalContext.Provider value={modalContextValue}>
        <ConfigContext.Provider value={configContextValue}>
          <ParamsContext.Provider value={paramsContextValue}>
            <UiLoggerContext.Provider value={uiLoggerContextValue}>
              {ui}
            </UiLoggerContext.Provider>
          </ParamsContext.Provider>
        </ConfigContext.Provider>
      </ModalContext.Provider>
    </Router>
  );
};

describe('TroubleShootingNewPage', () => {
  const defaultProps = {
    functions: {
      handleTroubleShootingAction: jest.fn(),
      handleAction: jest.fn(),
      processTroubleShootingPage: jest.fn()
    },
    values: {
      troubleShootingInfo: sessionUtility.getTroubleShootingJson(),
      landingInfo: {},
      symptom: {},
      selectedIssueOptionStep: '',
      thumbsDownSubmittedStep: false
    }
  };

  it('renders without crashing', () => {
    renderWithContexts(<WrappedComponent {...defaultProps} />);
  });
});
