// Jest imports
import '@testing-library/jest-dom';
import { shallow } from 'enzyme';

// Mock the TroubleShootingNewPage component
jest.mock('../TroubleShootingNewPage', () => {
  return {
    isEligibleForResumeEmail: (step = {}, navHistory = []) => {
      const { templateId = '', title = '' } = step;
      const templates = ['WAITING_FOR_RESPONSE', 'RESOLUTION_OPTIONS_ALL'];
      const hasArticle = navHistory.findIndex((item) => item.articleId);
      return templates.includes(templateId) || title.includes('End of Troubleshooting') || hasArticle === -1;
    },
    renderMessageModalBody: (modalParams) => {
      // Implementation of renderMessageModalBody method
    }
  };
});

// Import the mocked component
import TroubleShootingNewPage from '../TroubleShootingNewPage';

describe('isEligibleForResumeEmail', () => {
  describe('Template ID Based Eligibility', () => {
    test('should return true for WAITING_FOR_RESPONSE template', () => {
      const step = {
        templateId: 'WAITING_FOR_RESPONSE',
        title: 'Some Title'
      };
      const navHistory = [];
      
      expect(TroubleShootingNewPage.isEligibleForResumeEmail(step, navHistory)).toBe(true);
    });

    test('should return true for RESOLUTION_OPTIONS_ALL template', () => {
      const step = {
        templateId: 'RESOLUTION_OPTIONS_ALL',
        title: 'Some Title'
      };
      const navHistory = [];
      
      expect(TroubleShootingNewPage.isEligibleForResumeEmail(step, navHistory)).toBe(true);
    });

    test('should return false for non-matching template ID', () => {
      const step = {
        templateId: 'SOME_OTHER_TEMPLATE',
        title: 'Regular Step'
      };
      const navHistory = [{ articleId: 'article1' }];
      
      expect(TroubleShootingNewPage.isEligibleForResumeEmail(step, navHistory)).toBe(false);
    });
  });

  describe('Title Based Eligibility', () => {
    test('should return true when title includes "End of Troubleshooting"', () => {
      const step = {
        templateId: 'SOME_TEMPLATE',
        title: 'End of Troubleshooting - Success'
      };
      const navHistory = [{ articleId: 'article1' }];
      
      expect(TroubleShootingNewPage.isEligibleForResumeEmail(step, navHistory)).toBe(true);
    });

    test('should return false when title does not include "End of Troubleshooting"', () => {
      const step = {
        templateId: 'SOME_TEMPLATE',
        title: 'Regular Step Title'
      };
      const navHistory = [{ articleId: 'article1' }];
      
      expect(TroubleShootingNewPage.isEligibleForResumeEmail(step, navHistory)).toBe(false);
    });
  });

  describe('Navigation History Based Eligibility', () => {
    test('should return true when navHistory has no articles', () => {
      const step = {
        templateId: 'SOME_TEMPLATE',
        title: 'Regular Step'
      };
      const navHistory = [
        { id: 'step1' },
        { id: 'step2' }
      ];
      
      expect(TroubleShootingNewPage.isEligibleForResumeEmail(step, navHistory)).toBe(true);
    });

    test('should return false when navHistory has articles', () => {
      const step = {
        templateId: 'SOME_TEMPLATE',
        title: 'Regular Step'
      };
      const navHistory = [
        { id: 'step1', articleId: 'article1' },
        { id: 'step2' }
      ];
      
      expect(TroubleShootingNewPage.isEligibleForResumeEmail(step, navHistory)).toBe(false);
    });
  });

  describe('Edge Cases', () => {
    test('should handle empty step object', () => {
      const step = {};
      const navHistory = [];
      
      expect(TroubleShootingNewPage.isEligibleForResumeEmail(step, navHistory)).toBe(true);
    });

    test('should handle undefined parameters', () => {
      expect(TroubleShootingNewPage.isEligibleForResumeEmail()).toBe(true);
    });

    test('should handle null values in step object', () => {
      const step = {
        templateId: null,
        title: null
      };
      const navHistory = [];
      
      expect(TroubleShootingNewPage.isEligibleForResumeEmail(step, navHistory)).toBe(true);
    });

    test('should handle empty navHistory array', () => {
      const step = {
        templateId: 'SOME_TEMPLATE',
        title: 'Regular Step'
      };
      const navHistory = [];
      
      expect(TroubleShootingNewPage.isEligibleForResumeEmail(step, navHistory)).toBe(true);
    });
  });
});

describe('renderMessageModalBody', () => {
  it('should render both heading and description when provided', () => {
    const modalParams = {
      heading: 'Test Heading',
      description: 'Test Description'
    };

    const wrapper = shallow(TroubleShootingNewPage.renderMessageModalBody(modalParams));
    
    expect(wrapper.find('Title').exists()).toBe(true);
    expect(wrapper.find('Title').find('TextWithHtml').prop('children')).toBe('Test Heading');
    expect(wrapper.find('Body').exists()).toBe(true);
    expect(wrapper.find('Body').find('TextWithHtml').prop('children')).toBe('Test Description');
    expect(wrapper.find('SpacerDiv').prop('height')).toBe('20px');
  });

  it('should render only heading when description is not provided', () => {
    const modalParams = {
      heading: 'Test Heading'
    };

    const wrapper = shallow(TroubleShootingNewPage.renderMessageModalBody(modalParams));
    
    expect(wrapper.find('Title').exists()).toBe(true);
    expect(wrapper.find('Title').find('TextWithHtml').prop('children')).toBe('Test Heading');
    expect(wrapper.find('Body').exists()).toBe(false);
    expect(wrapper.find('SpacerDiv').exists()).toBe(true);
  });

  it('should render only description when heading is not provided', () => {
    const modalParams = {
      description: 'Test Description'
    };

    const wrapper = shallow(TroubleShootingNewPage.renderMessageModalBody(modalParams));
    
    expect(wrapper.find('Title').exists()).toBe(false);
    expect(wrapper.find('SpacerDiv').exists()).toBe(false);
    expect(wrapper.find('Body').exists()).toBe(true);
    expect(wrapper.find('Body').find('TextWithHtml').prop('children')).toBe('Test Description');
  });

  it('should render empty fragment when neither heading nor description is provided', () => {
    const modalParams = {};

    const wrapper = shallow(TroubleShootingNewPage.renderMessageModalBody(modalParams));
    
    expect(wrapper.find('Title').exists()).toBe(false);
    expect(wrapper.find('Body').exists()).toBe(false);
    expect(wrapper.find('SpacerDiv').exists()).toBe(false);
    expect(wrapper.children()).toHaveLength(0);
  });
}); 
